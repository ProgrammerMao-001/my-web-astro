---
title: "乌兰察布市智慧公路管理平台"
description: "负责项目的整个前端建设"
pubDate: "2024.5.02"
projectCycle: "2024.5.02 - 2024.11.01"
image: /image/blog/highway-gateway-pc/banner.png
categories:
  - 公司项目
tags:
  - web
  - app
  - h5
  - vue
  - 百度地图
  - 小程序
  - 雷达
  - 海康监控
  - 大屏
---
## 项目介绍

> 本系统涵盖多个子系统，每个子系统拥有独立的部门和角色数据。所有用户数据均在主系统中集中管理。
所有的子系统包含各自的业务模块，单独部署，方便维护和扩展并且支持第三方平台的接入。
其中资产管理系统、养护管理系统、信息发布系统均由原先的系统迁移过来，并做相应的修改，详情可以点击标题查看具体介绍。

1. 门户主系统
![门户主系统](/image/blog/highway-gateway-pc/gateway.png)
2. 一张图系统
![一张图系统](/image/blog/highway-gateway-pc/aPicture.png)
3. [资产管理系统(原设备设施管理平台)](/blog/facility-pc)
![资产管理系统](/image/blog/highway-gateway-pc/asset.png)
4. [养护管理系统](/blog/tlxx-glyh-pc)
![养护管理系统](/image/blog/highway-gateway-pc/maintain.png)
5. [养护管理系统H5](/blog/tlxx-glyh-pc)
![养护管理系统H5](/image/blog/highway-gateway-pc/maintain-h5.png)
6. [信息发布系统(原交通态势系统)](/blog/traffic-situation-pc)
![信息发布系统](/image/blog/highway-gateway-pc/information.png)

## 项目难点

### 单点登录
> 由于每个子系统部署在不同的服务器上，存在域名、端口号和协议不一致的情况。然而，所有用户数据均在主系统中集中管理。
为了解决这一问题，我们采用了通过地址栏加密传输token和projectId的方式来判断用户进入的是哪个子系统，类似于QQ中点击QQ邮箱可以实现免登的效果。

### mqtt订阅
> 系统需要获取路段上配置的雷达设备编号来订阅MQTT主题，实现实时展示车辆在路段上的行驶轨迹。地图上通过marker实时更新车辆位置，
并且在点击路段时打开弹窗展示路段详情，同时在弹窗中也展示车辆的实时位置。

### 海康视频流播放
> 系统默认使用video.js插件播放视频。如果用户安装了海康视频播放插件，则使用海康插件播放【video.js通过调用接口的形式实现，而海康插件则自带了这些功能仅需项目中引入SDK即可】
并支持以下功能：
- 旋转
- 聚焦
- 截图
- 回放
- 自主码流切换
- 录像
- 喊话

### 百度地图
> 项目中存在大量的图层交互事件，因此我们在百度地图API的基础上封装了一套更通用化的百度地图Vue组件库，以方便后续维护。该组件库主要支持以下功能：

- **图层管理**：添加和删除图层，包括点、线、多边形、文字、图片和自定义图层。
- **交互事件**：支持图层的交互事件，例如点击点位时将该点位替换图标以区分是否选中。
- **图层动效**：提供多种图层动效，如点位闪烁（预警效果）、区域边界绘制和线段动画。
- **点聚合**：
1. 支持指定层级聚合。
2. 支持自定义聚合效果。
3. 支持自定义聚合规则。
4. 支持自定义聚合图标。
5. 暴露鼠标事件以便进一步操作。

### 文件上传
> 前面提到了利用海康视频插件来播放直播流，系统中就有个维护附件资源的功能，
其中海康插件内存占用大于500MB，导致上传附件时频繁崩溃，因此我们利用webwork实现大文件分片上传。

### 扫码登录
> 浙政钉、微信扫码登录【用户在后台扫码绑定微信或浙政钉授权码，绑定成功后，就可以通过扫码登录系统】

![浙政钉扫码绑定](/image/blog/highway-gateway-pc/qrcode.png)

### 信息屏硬件对接
1. 系统中配置好节目单【图片、文本、视频】
2. 选择系统中维护的信息屏
3. 调用硬件厂商提供的接口
4. 实现信息屏节目的实时更新。
![节目编辑](/image/blog/highway-gateway-pc/programme.png)

### h5第三方授权免登
> 养护h5是嵌套在第三方微信小程序里的，因此需实现第三方免登进入系统。
前提：第三方微信小程序登录账号的手机号在我们系统中已经注册
主要实现流程：
1. 微信小程序登录，点击**养护管理**入口
2. 小程序端将token和appid传给h5
3. h5调用第三方系统接口，获取用户的手机号
4. h5调用本系统接口，获取用户token和其他基础信息
5. 成功免登跳转至系统首页

![微信小程序](/image/blog/highway-gateway-pc/app.png)
